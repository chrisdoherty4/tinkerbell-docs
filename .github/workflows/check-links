#!/usr/bin/env bash

set -euxo pipefail

skips=(
	--skip assets/javascripts/bundle           # generated by mkdocs
	--skip cloud-native.slack.com              # is a weird redirect I don't want to hard code
	--skip cloud.typography.com                # requires a referer that we can't set
	--skip console.equinix.com                 # requires a web browser user agent we can't set
	--skip discussion_r442151095               # github has this comment collapsed I guess
	--skip metal.equinix.com                   # requires a web browser user agent we can't set
	--skip www.cyberciti.biz                   # requires a web browser user agent we can't set
	--skip www.virtualbox.org/manual/ch06.html # hyperlink fails to parse embedded css
)

# skips failing on external links, errors on bad internal links
hyperlink "${skips[@]}" \
	--canonicalroot https://docs.tinkerbell.org \
	--internal site/index.html \
	--recursive \
	site/index.html

# checks external links too but we don't break the build for them
hyperlink "${skips[@]}" \
	--canonicalroot https://docs.tinkerbell.org \
	--recursive \
	site/index.html || true
